# ğŸ›ï¸ Enhanced Loss Function Parameter Tuning Cheat Sheet

## ğŸ“Š æ ¸å¿ƒå¯è°ƒå‚æ•°ä¸€è§ˆè¡¨

| å‚æ•°ç»„ | å‚æ•°å | é»˜è®¤å€¼ | è°ƒæ•´èŒƒå›´ | ä¸»è¦ä½œç”¨ |
|--------|--------|--------|----------|----------|
| **Loss Weights** | `focal` | 1.0 | 0.5-2.0 | æ§åˆ¶ç±»åˆ«ä¸å¹³è¡¡å¤„ç†å¼ºåº¦ |
|  | `iou` | 1.0 | 0.5-2.0 | æ§åˆ¶é‡å è´¨é‡é‡è¦æ€§ |
|  | `boundary` | 0.2 | 0.1-1.0 | æ§åˆ¶è¾¹ç¼˜æ£€æµ‹ç²¾åº¦ |
| **Focal Params** | `alpha` | 0.75 | 0.25-0.95 | æ­£è´Ÿæ ·æœ¬é‡è¦æ€§å¹³è¡¡ |
|  | `gamma` | 2.0 | 1.0-5.0 | å›°éš¾æ ·æœ¬å…³æ³¨åº¦ |

## ğŸ¯ é—®é¢˜å¯¼å‘çš„è°ƒå‚ç­–ç•¥

### ğŸš¨ é—®é¢˜1: æ¼æ£€å¤ªå¤š (Low Recall, High Precision)
**ç—‡çŠ¶**: å¾ˆå¤šradio burstæ²¡è¢«æ£€æµ‹åˆ°ï¼Œä½†æ£€æµ‹åˆ°çš„éƒ½æ˜¯å¯¹çš„

**è°ƒå‚æ–¹æ¡ˆ**:
```python
loss_weights = {'focal': 1.5, 'iou': 1.5, 'boundary': 0.2}
focal_params = {'alpha': 0.85, 'gamma': 3.0}
```

**è§£é‡Š**: 
- â†‘ `alpha` (0.75â†’0.85): æ›´å…³æ³¨æ­£æ ·æœ¬
- â†‘ `gamma` (2.0â†’3.0): æ›´å…³æ³¨å›°éš¾æ ·æœ¬  
- â†‘ `focal_weight` (1.0â†’1.5): åŠ å¼ºfocal lossä½œç”¨

---

### ğŸš¨ é—®é¢˜2: è¯¯æ£€å¤ªå¤š (High Recall, Low Precision)  
**ç—‡çŠ¶**: æ£€æµ‹åˆ°å¾ˆå¤šburstï¼Œä½†å¾ˆå¤šæ˜¯å™ªå£°

**è°ƒå‚æ–¹æ¡ˆ**:
```python
loss_weights = {'focal': 0.8, 'iou': 1.5, 'boundary': 0.4}
focal_params = {'alpha': 0.65, 'gamma': 2.0}
```

**è§£é‡Š**:
- â†“ `alpha` (0.75â†’0.65): æ›´å…³æ³¨è´Ÿæ ·æœ¬
- â†‘ `boundary_weight` (0.2â†’0.4): åŠ å¼ºè¾¹ç¼˜è´¨é‡
- â†‘ `iou_weight` (1.0â†’1.5): è¦æ±‚æ›´å¥½çš„é‡å 

---

### ğŸš¨ é—®é¢˜3: è¾¹ç•Œæ¨¡ç³Š (Good Detection, Poor Edges)
**ç—‡çŠ¶**: èƒ½æ£€æµ‹åˆ°burstï¼Œä½†è¾¹ç•Œä¸ç²¾ç¡®

**è°ƒå‚æ–¹æ¡ˆ**:
```python
loss_weights = {'focal': 1.0, 'iou': 1.0, 'boundary': 0.6}
focal_params = {'alpha': 0.75, 'gamma': 2.0}  # ä¿æŒé»˜è®¤
```

**è§£é‡Š**:
- â†‘ `boundary_weight` (0.2â†’0.6): é‡ç‚¹å…³æ³¨è¾¹ç¼˜
- å…¶ä»–å‚æ•°ä¿æŒé»˜è®¤ï¼Œä¸“æ³¨è¾¹ç¼˜æ”¹è¿›

---

### ğŸš¨ é—®é¢˜4: è®­ç»ƒä¸ç¨³å®š (Loss Oscillation)
**ç—‡çŠ¶**: Lossæ›²çº¿éœ‡è¡ï¼Œè®­ç»ƒä¸æ”¶æ•›

**è°ƒå‚æ–¹æ¡ˆ**:
```python
loss_weights = {'focal': 0.8, 'iou': 0.8, 'boundary': 0.1}
focal_params = {'alpha': 0.6, 'gamma': 1.5}
```

**è§£é‡Š**:
- â†“ `gamma` (2.0â†’1.5): å‡å°‘æ¿€è¿›å…³æ³¨
- â†“ æ‰€æœ‰æƒé‡: é™ä½losså¼ºåº¦
- `alpha`è¶‹å‘0.5: æ›´å¹³è¡¡çš„ç±»åˆ«å¤„ç†

---

### ğŸš¨ é—®é¢˜5: æåº¦ä¸å¹³è¡¡ (Severe Class Imbalance)
**ç—‡çŠ¶**: æ¨¡å‹å‡ ä¹åªé¢„æµ‹èƒŒæ™¯ï¼Œradio burstå¤ªç¨€å°‘

**è°ƒå‚æ–¹æ¡ˆ**:
```python
loss_weights = {'focal': 2.0, 'iou': 1.5, 'boundary': 0.1}
focal_params = {'alpha': 0.9, 'gamma': 4.0}
```

**è§£é‡Š**:
- â†‘â†‘ `alpha` (0.75â†’0.9): æåº¦å…³æ³¨æ­£æ ·æœ¬
- â†‘â†‘ `gamma` (2.0â†’4.0): æåº¦å…³æ³¨å›°éš¾æ ·æœ¬
- â†‘â†‘ `focal_weight` (1.0â†’2.0): focal lossä¸»å¯¼

## ğŸ”§ ç³»ç»ŸåŒ–è°ƒå‚æµç¨‹

### Step 1: é—®é¢˜è¯Šæ–­
```python
from loss_tuner import quick_tune

# è¾“å…¥ä½ çš„éªŒè¯æŒ‡æ ‡
val_metrics = {
    'precision': 0.85,  # ä½ çš„precision
    'recall': 0.45,     # ä½ çš„recall  
    'f1': 0.59,         # ä½ çš„f1
    'iou': 0.42         # ä½ çš„iou
}

# è·å¾—å»ºè®®å‚æ•°
suggested = quick_tune(val_metrics)
```

### Step 2: åº”ç”¨å»ºè®®å‚æ•°
```python
# åœ¨è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨
loss = combined_loss(
    y_true, y_pred,
    loss_weights=suggested['loss_weights'],
    focal_params=suggested['focal_params']
)
```

### Step 3: è¿­ä»£ä¼˜åŒ–
- è®­ç»ƒ10-20ä¸ªepoch
- è§‚å¯ŸéªŒè¯æŒ‡æ ‡å˜åŒ–è¶‹åŠ¿
- å¦‚æœæ”¹å–„ï¼Œç»§ç»­åŒæ–¹å‘è°ƒæ•´
- å¦‚æœæ²¡æ”¹å–„ï¼Œå°è¯•å…¶ä»–ç­–ç•¥

## ğŸ¯ å¿«é€Ÿå‚è€ƒè¡¨

| ä½ çš„é—®é¢˜ | ä¸»è¦è°ƒæ•´ | æ¬¡è¦è°ƒæ•´ |
|----------|----------|----------|
| **æ¼æ£€ä¸¥é‡** | `alphaâ†‘`, `gammaâ†‘` | `focal_weightâ†‘` |
| **è¯¯æ£€ä¸¥é‡** | `alphaâ†“`, `boundary_weightâ†‘` | `iou_weightâ†‘` |
| **è¾¹ç•Œæ¨¡ç³Š** | `boundary_weightâ†‘` | ä¿æŒå…¶ä»–é»˜è®¤ |
| **è®­ç»ƒä¸ç¨³** | `gammaâ†“`, æ‰€æœ‰æƒé‡â†“ | `alpha`è¶‹å‘0.5 |
| **æåº¦ä¸å¹³è¡¡** | `alphaâ†‘â†‘`, `gammaâ†‘â†‘` | `focal_weightâ†‘â†‘` |

## ğŸ’¡ å®ç”¨æŠ€å·§

### ğŸ”¥ é’ˆå¯¹Solar Radio Burstçš„æœ€ä½³èµ·ç‚¹:
```python
# æ¨èçš„èµ·å§‹é…ç½®
loss_weights = {'focal': 1.2, 'iou': 1.5, 'boundary': 0.2}
focal_params = {'alpha': 0.8, 'gamma': 2.5}
```

### âš¡ å¿«é€ŸéªŒè¯æ–¹æ³•:
1. ç”¨å»ºè®®å‚æ•°è®­ç»ƒ5-10 epochs
2. å¦‚æœval_lossä¸‹é™è¶‹åŠ¿è‰¯å¥½â†’ç»§ç»­
3. å¦‚æœval_losséœ‡è¡æˆ–ä¸Šå‡â†’å°è¯•å…¶ä»–é…ç½®

### ğŸ“Š ç›‘æ§é‡ç‚¹:
- **Focal losså€¼**: åº”è¯¥éšè®­ç»ƒä¸‹é™
- **Boundary losså€¼**: è¾¹ç•Œä»»åŠ¡çš„æ”¹å–„æŒ‡æ ‡
- **Validation F1**: ä¸»è¦ä¼˜åŒ–ç›®æ ‡
- **Validation IoU**: å®šä½è´¨é‡æŒ‡æ ‡

### ğŸ›ï¸ å¾®è°ƒæŠ€å·§:
- **å°æ­¥è°ƒæ•´**: æ¯æ¬¡æ”¹å˜Â±10-20%
- **å•å˜é‡æ³•**: ä¸€æ¬¡åªè°ƒä¸€ä¸ªå‚æ•°ç»„
- **å¯¹æ¯”éªŒè¯**: ä¿ç•™åŸlossåšbaselineå¯¹æ¯”
- **è€å¿ƒç­‰å¾…**: ç»™æ¯ä¸ªé…ç½®è¶³å¤Ÿçš„è®­ç»ƒæ—¶é—´

### âš ï¸ æ³¨æ„äº‹é¡¹:
- ä¸è¦åœ¨validation setä¸Šè¿‡åº¦è°ƒå‚
- ä¿ç•™test setåšæœ€ç»ˆéªŒè¯
- è®°å½•æ¯æ¬¡å®éªŒçš„å‚æ•°å’Œç»“æœ
- è€ƒè™‘æ•°æ®è´¨é‡å¯¹å‚æ•°é€‰æ‹©çš„å½±å“

## ğŸš€ ç«‹å³å¼€å§‹

æœ€ç®€å•çš„å¼€å§‹æ–¹å¼ï¼š

```python
# 1. è¯Šæ–­å½“å‰é—®é¢˜
from loss_tuner import LossTuner
tuner = LossTuner()
problem, strategy = tuner.diagnose_problem(your_val_metrics)

# 2. è·å¾—å»ºè®®å‚æ•°  
suggested = tuner.suggest_parameters(your_val_metrics)

# 3. åº”ç”¨åˆ°è®­ç»ƒ
loss = combined_loss(y_true, y_pred, **suggested)

# 4. è®­ç»ƒå¹¶è§‚å¯Ÿæ”¹å–„
```

è®°ä½ï¼š**è°ƒå‚æ˜¯è¿­ä»£è¿‡ç¨‹ï¼Œä»å»ºè®®é…ç½®å¼€å§‹ï¼Œæ ¹æ®ç»“æœé€æ­¥ä¼˜åŒ–ï¼**
